# Configuración para producción en Google Cloud
spring:
  application:
    name: users_ms
  jpa:
    hibernate:
      ddl-auto: none
    generate-ddl: false
    properties:
      hibernate:
        show_sql: false
        format_sql: false
        jdbc.lob.non_contextual_creation: true
        generate_statistics: false
    open-in-view: false
  datasource:
    driver-class-name: org.postgresql.Driver
    # URL de Cloud SQL con socket factory
    # Nota: El formato jdbc:postgresql:/// (sin host:puerto) es correcto para Cloud SQL
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql:///mp_parking_app?cloudSqlInstance=testauth20-394320:us-central1:parkingprodgcloud&socketFactory=com.google.cloud.sql.postgres.SocketFactory}
    username: ${SPRING_DATASOURCE_USERNAME:postgres}
    # Password se carga desde Google Cloud Secret Manager (secreto: passwirk_sec)
    # SecretManagerConfig establece:
    #   1. spring.datasource.password (propiedad de Spring con mayor prioridad)
    #   2. SPRING_DATASOURCE_PASSWORD (propiedad del sistema como fallback)
    # Spring Boot usará automáticamente spring.datasource.password si está disponible
    # Si no, usará SPRING_DATASOURCE_PASSWORD establecido por SecretManagerConfig
    #______________Sdasaydausyda____________
    password: ZPXFqR70~2AU:FSZ #______________Sdasaydausyda____________
    #______________Sdasaydausyda____________
    hikari:
      maxLifetime: 1800000
      maximum-pool-size: 10
      minimum-idle: 1
      idle-timeout: 600000
      connection-timeout: 30000
      connection-test-query: SELECT 1
      # Configuración adicional para Cloud SQL
      connection-init-sql: SELECT 1
  flyway:
    baseline-on-migrate: true
    baseline-version: 0
    table: flyway_${spring.application.name}
    enabled: true
    outOfOrder: true
  jwtSecret: ${SPRING_JWT_SECRET:4A404E635266556A586E3272357538782F413F4428472D4B6150645367566B59}
  jwtExpirationInMs: ${SPRING_JWT_EXPIRATION:100000000}

# Configuración de Google Cloud Secret Manager
gcp:
  secret-manager:
    enabled: ${GCP_SECRET_MANAGER_ENABLED:true}
    project-id: ${GCP_PROJECT_ID:649345514504}

server:
  port: ${PORT:8080}
  error:
    include-stacktrace: never

# Configuración de Spring Boot Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
      probes:
        enabled: true
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true
    db:
      enabled: true

logging:
  level:
    root: INFO
    com.webstore.usersMs: INFO
    com.webstore.usersMs.config.SecretManagerConfig: DEBUG
    org.springframework.web: INFO
    org.springframework.boot.web.embedded.tomcat: INFO
    org.hibernate: WARN
    org.postgresql: DEBUG
    com.zaxxer.hikari: DEBUG
    com.google.cloud.sql: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
